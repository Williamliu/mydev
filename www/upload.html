<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
		<meta charset="utf8" />
		<!-- JQuery3.1.1 -->
		<script type="text/javascript" src="jquery/min/jquery-3.1.1.min.js"></script>
		<script type="text/javascript" src="jquery/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
		<link href='jquery/jquery-ui-1.12.1.custom/jquery-ui.min.css' rel='stylesheet' type='text/css'>
		<!-- //JQuery -->

		<!-- AngularJS 1.3.15 -->
		<script	src="angularjs/angular-1.3.15/angular.js" type="text/javascript"></script>
		<script	src="angularjs/angular-1.3.15/angular-cookies.js" type="text/javascript"></script>
		<script src="angularjs/angular-1.3.15/angular-sanitize.min.js" type="text/javascript"></script>
		<!-- //AngularJS -->

		<!-- wliu components -->
		<script src="js/wliu/wliu.common.js" type="text/javascript"></script>
		<script src="js/wliu/wliu.table.js" type="text/javascript"></script>
		<script src="js/wliu/wliu.image.js" type="text/javascript"></script>
	
    	<script	src="angularjs/wliu/wliu.image.js" type="text/javascript"></script>
		<script	src="angularjs/wliu/wliu.table.js" type="text/javascript"></script>
		<script	src="angularjs/wliu/wliu.table.filter.js" type="text/javascript"></script>
		<script	src="angularjs/wliu/wliu.table.list.js" type="text/javascript"></script>

		<script src="jquery/wliu/diag/wliu.jquery.diag.js" type="text/javascript"></script>
		<link 	href='jquery/wliu/diag/wliu.jquery.diag.css' type='text/css' rel='stylesheet' />
		<script src="jquery/wliu/popup/wliu.jquery.popup.js" type="text/javascript"></script>
		<link 	href='jquery/wliu/popup/wliu.jquery.popup.css' type='text/css' rel='stylesheet' />
		<script src="jquery/wliu/loading/wliu.jquery.loading.js" type="text/javascript"></script>
		<link 	href="jquery/wliu/loading/wliu.jquery.loading.css" type='text/css' rel='stylesheet' />


		<link href='theme/wliu/wliu.common.css' type='text/css' rel='stylesheet' />
		<link href='theme/wliu/wliu.buttons.css' type='text/css' rel='stylesheet' />
		<!-- //wliu components -->


        <script language="javascript" type="text/javascript">
        var app = angular.module("myApp", ["wliuImage"]);
  
        app.controller("myImage", function ($scope) {
            $scope.wimg = new WLIU.IMAGEACTION({filter:"myimage", key:101, fkey:201, view:"medium"});
            $scope.listObj = { rowno: 0, view:"medium", list:[] };
            $scope.fileSelect = function(event) {
                files = (event.srcElement || event.target).files;
                $scope.processFiles(files);
            };
            $scope.image = {};
            $scope.processFiles = function(files) {
                for(var fidx = 0; fidx < files.length; fidx++) {                
                    $scope.readFile(files[fidx]);
                }
            };
            
            $scope.readFile= function( theFile ) {
                $scope.wimg.fromFile(theFile, function(imgObj, error){
                    if(error && error.errorCode == 1 ) {
                        alert(error.errorMessage);
                    } else {
                       $scope.wimg.cropDivReset($("#crop_mm"));
                       $scope.listObj.list = [];
                       $scope.listObj.list.push($scope.wimg.getImage());
                       $scope.$apply();
                       
                       $("#imgdiag").trigger("show");
                    }
                });
            };
            
            $scope.reset = function() {
                $scope.wimg.cropReset( function(imgObj){
                    $("#" + $scope.wimg.view ).attr("src", imgObj.data);
                });
            }      
        });

        $(function(){
                $("div.wliu-image-crop", "#wmview").draggable({
                    containment: "parent"
                });

				$("div.wliu-image-crop", "#wmview").resizable({ 
                    containment: "parent"
   			    });
        })
        </script>
</head>
<body ng-app="myApp">
<div ng-controller="myImage">
 
    <div style="display:inline-block;position:relative; padding:20px; border:1px solid #cccccc;">
     <input type="file"
            onchange="angular.element(this).scope().fileSelect(event);" 
            style="display:block; position:absolute; opacity:1; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%; border:1px solid red; z-index:0;" value="Browse..." />
         
    </div>


    <INPUT type="button" ng-click="iexport()" value="Export" />
    <br>

    <!--
    <div class="wliu-image-frame" id="wmview">
        <img src="{{listObj.list[0].resize.large.data?listObj.list[0].resize.large.data:''}}" />
        <div class="wliu-image-crop">
            <div class="wliu-image-crop-h"></div>
            <div class="wliu-image-crop-v"></div>
        </div>
    </div>
    -->        

    <image.viewer imglist="listObj" targetid="imgdiag" view="large"></image.viewer>

    <INPUT type="button" onclick="" value="Upload" wliu-diag diag-target="#imgdiag" diag-toggle="click" />
    <INPUT type="button" onclick="reset()" value="Reset" />
</div>
</body>
</html>